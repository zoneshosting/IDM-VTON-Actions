                    </li>
                    </ul>
                `);
                return;
            }

            const runButton = document.getElementById('runButton');
            runButton.disabled = true;
            runButton.innerHTML = '<span class="loading"></span> Processing...';

            try {
                // Hide any previous results
                document.getElementById('resultsSection').classList.remove('show');
                document.getElementById('statusSection').classList.remove('show');
                
                // Start the simulation
                await simulateVirtualTryOn();
                
            } catch (error) {
                showStatus('error', `Error during processing: ${error.message}`);
                document.getElementById('progressSection').classList.remove('show');
            } finally {
                runButton.disabled = false;
                runButton.innerHTML = '<i class="fas fa-play"></i> Run Virtual Try-On';
            }
        }

        // Utility function to validate URLs
        function isValidUrl(string) {
            try {
                new URL(string);
                return string.startsWith('http://') || string.startsWith('https://');
            } catch (_) {
                return false;
            }
        }

        // Setup drag and drop
        function setupDragAndDrop(uploadBoxId, fileInputId) {
            const uploadBox = document.getElementById(uploadBoxId);
            const fileInput = document.getElementById(fileInputId);

            if (uploadBox && fileInput) {
                uploadBox.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    uploadBox.classList.add('dragover');
                });

                uploadBox.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    uploadBox.classList.remove('dragover');
                });

                uploadBox.addEventListener('drop', function(e) {
                    e.preventDefault();
                    uploadBox.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        fileInput.files = files;
                        fileInput.dispatchEvent(new Event('change'));
                    }
                });
            }
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing enhanced interface...');
            
            // Set up event listeners
            const exampleBtn = document.getElementById('exampleBtn');
            const runButton = document.getElementById('runButton');
            
            if (exampleBtn) {
                exampleBtn.addEventListener('click', loadExample);
            }
            
            if (runButton) {
                runButton.addEventListener('click', runVirtualTryOn);
            }

            // Initialize file uploads
            setupFileUpload('personFile', 'personPreview', 'personImg', 'personStatus', 'personUpload', 'person');
            setupFileUpload('garmentFile', 'garmentPreview', 'garmentImg', 'garmentStatus', 'garmentUpload', 'garment');
            setupDragAndDrop('personUpload', 'personFile');
            setupDragAndDrop('garmentUpload', 'garmentFile');
            
            console.log('Enhanced initialization complete');
        });
    </script>
</body>
</html>
